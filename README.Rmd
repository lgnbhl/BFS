---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/BFS)](https://CRAN.R-project.org/package=BFS)
[![Grand total](https://cranlogs.r-pkg.org/badges/grand-total/BFS)](https://cran.r-project.org/package=BFS)
[![R build status](https://github.com/lgnbhl/BFS/workflows/R-CMD-check/badge.svg)](https://github.com/lgnbhl/BFS/actions)
<!-- badges: end -->

# BFS <img src="man/figures/logo.png" align="right" />

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

> Search and download data from the Swiss Federal Statistical Office

The `BFS` package allows to search and download public data from the 
[Swiss Federal Statistical Office](https://www.bfs.admin.ch/bfs/en/home/statistics/catalogues-databases/data.html){target="_blank"} (BFS is for *Bundesamt f√ºr Statistik* in German) in a dynamic and reproducible way.

## Installation

```{r eval=FALSE}
# Install the released version from CRAN
install.packages("BFS")
```

To get a bug fix, or use a feature from the development version, you can install BFS from GitHub.

```{r eval=FALSE}
# install from Github
devtools::install_github("lgnbhl/BFS")
```

## Usage

```{r load BFS}
library(BFS)
```

### Get the data catalog

To search and download data from the Swiss Federal Statistical Office, you first need to retrieve information about the available public datasets.

You can get the data catalog by language based on their official [RSS feed](https://www.bfs.admin.ch/bfs/en/home/statistiken/kataloge-datenbanken/daten/_jcr_content/par/ws_catalog.rss.xml?skipLimit=true). Unfortunately, it seems that not all public data is listed inside the RSS feed. Note also that Italian and English give access to less datasets.

```{r}
catalog_data_en <- bfs_get_catalog_data(language = "en")

catalog_data_en
```

### Search for a specific dataset

```{r bfs_search}
library(dplyr)

catalog_data_uni <- catalog_data_en %>%
  filter(title == "University students by year, ISCED field, sex and level of study")

catalog_data_uni
```

### Download a dataset in any language

To download a BFS dataset, add the related URL link from the `url_bfs` column of the downloaded metadata as an argument to the `bfs_get_data()` function.

```{r bfs_get_data}
df_uni <- bfs_get_data(url_bfs = catalog_data_uni$url_bfs, language = "en")

df_uni
```

You can access additional information about the downloaded data set using the `bfs_get_data_comments()` function.

```{r attributes}
bfs_get_data_comments(url_bfs = catalog_data_uni$url_bfs, language = "en")
```

In case the data is not present in the data catalog, you can add manually the BFS number in the `bfs_get_data()` function using the `number_bfs` argument. For example, if the data used until now as an example is not accessible using `bfs_get_catalog()`, you could try to find the BFS number manually:

```{r browseURL, eval=FALSE}
# open webpage
browseURL("https://www.bfs.admin.ch/content/bfs/en/home/statistiken/kataloge-datenbanken/daten.assetdetail.16324907.html")
```

<img style="border:1px solid black;" src="https://raw.githubusercontent.com/lgnbhl/BFS/master/man/figures/screenshot.png" align="center" />

<br/>

You can use again `bfs_get_data()` but this time with the `number_bfs` argument.

```{r, eval=FALSE}
bfs_get_data(number_bfs = "px-x-1502040100_131", language = "en")
```

### Catalog of tables

A lot of file are not accessible through the API, but is still present in the official BFS website. You can access the [RSS feed tables catalog](https://www.bfs.admin.ch/bfs/en/home/statistiken/kataloge-datenbanken/tabellen/_jcr_content/par/ws_catalog.rss.xml?skipLimit=true) using the `bfs_get_catalog_tables()`. Most of them are Excel files. Note that only a part of all the public tables seem accessible using the RSS feed.

```{r}
catalog_tables_en <- bfs_get_catalog_tables(language = "en")

catalog_tables_en
```

```{r}
library(dplyr)
library(openxlsx)

catalog_tables_en %>%
  filter(title == "Admissions to universities of applied sciences at diploma and bachelor level by fields of specialisation") %>%
  pull(url_table) %>%
  openxlsx::read.xlsx(startRow = 2) %>%
  as_tibble()
```

## Other information

A [blog article](https://felixluginbuhl.com/blog/posts/2019-11-07-swiss-data/) showing a concrete example about how to use the BFS package and to visualize the data in a Swiss map.

The BFS package is using the [pxweb](https://github.com/rOpenGov/pxweb){target="_blank"} R package under the hood to access the Swiss Federal Statistical Office pxweb API.

This package is in no way officially related to or endorsed by the Swiss Federal Statistical Office (BFS).

## Code of Conduct
  
Please note that the BFS project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.
